---
import katalogusData from '../../katalogus.json';
const katalogus = katalogusData;
---

<html lang="hu">
<head>
    <meta charset="utf-8" />
    <title>Smart Home Planner Pro</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: sans-serif; padding: 20px; }
        .controls { background: #1e1e1e; padding: 20px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        select, input, button { background: #2d2d2d; color: white; border: 1px solid #444; padding: 10px; border-radius: 4px; margin: 5px; }
        button { background: #2ecc71; color: black; font-weight: bold; cursor: pointer; border: none; }
        button:hover { opacity: 0.8; }
        button.save { background: #3498db; }
        button.load { background: #f1c40f; }
        button.delete { background: #e74c3c; color: white; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #333; text-align: left; }
        th { background: #252525; color: #2ecc71; }
        .total { font-size: 1.5rem; color: #2ecc71; text-align: right; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üè† Okosotthon Tervez≈ë</h1>

    <div class="controls">
        <strong>√úgyf√©l neve:</strong> 
        <input type="text" id="clientName" placeholder="Pl: Kov√°cs J√°nos" />
        <button class="save" onclick="saveProject()">üíæ Ment√©s</button>
        <button class="load" onclick="loadProject()">üìÇ Bet√∂lt√©s</button>
        <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
        
        <strong>Eszk√∂z hozz√°ad√°sa:</strong>
        <select id="deviceSelect">
            <option value="">-- V√°lassz eszk√∂zt --</option>
            {Object.keys(katalogus).map(id => <option value={id}>{id} ({katalogus[id].price} Ft)</option>)}
        </select>
        <input type="text" id="roomInput" placeholder="Helyis√©g (pl: Nappali)" />
        <input type="number" id="qtyInput" value="1" style="width: 60px;" />
        <button onclick="addDevice()">‚ûï Hozz√°ad</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Helyis√©g</th>
                <th>Eszk√∂z</th>
                <th>Egys√©g√°r</th>
                <th>db</th>
                <th>√ñsszesen</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="total" id="grandTotal">Mind√∂sszesen: 0 Ft</div>

    <script define:vars={{ katalogus }}>
        let currentProject = [];

        window.addDevice = () => {
            const id = document.getElementById('deviceSelect').value;
            const room = document.getElementById('roomInput').value || 'Nincs megadva';
            const qty = parseInt(document.getElementById('qtyInput').value);
            if (!id) return alert('V√°lassz eszk√∂zt!');
            
            const price = katalogus[id].price;
            currentProject.push({ id, room, qty, price });
            render();
        };

        window.render = () => {
            const body = document.getElementById('tableBody');
            body.innerHTML = '';
            let total = 0;
            currentProject.forEach((item, index) => {
                const subtotal = item.price * item.qty;
                total += subtotal;
                body.innerHTML += `<tr>
                    <td>${item.room}</td>
                    <td>${item.id}</td>
                    <td>${item.price.toLocaleString()} Ft</td>
                    <td>${item.qty} db</td>
                    <td>${subtotal.toLocaleString()} Ft</td>
                    <td><button class="delete" onclick="remove(${index})">X</button></td>
                </tr>`;
            });
            document.getElementById('grandTotal').innerText = `Mind√∂sszesen: ${total.toLocaleString()} Ft`;
        };

        window.remove = (index) => {
            currentProject.splice(index, 1);
            render();
        };

        window.saveProject = () => {
            const name = document.getElementById('clientName').value;
            if (!name) return alert('Adj meg egy nevet!');
            localStorage.setItem('planner_' + name, JSON.stringify(currentProject));
            alert('Projekt elmentve a b√∂ng√©sz≈ëbe!');
        };

        window.loadProject = () => {
            const name = document.getElementById('clientName').value;
            const data = localStorage.getItem('planner_' + name);
            if (data) {
                currentProject = JSON.parse(data);
                render();
            } else {
                alert('Nincs mentett projekt ezen a n√©ven!');
            }
        };
    </script>
</body>
</html>